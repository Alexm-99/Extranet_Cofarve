{% extends 'encabezado2.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>



  {% block estilos %}
  <link rel="stylesheet" href='{% static "./css/styleAdmin.css" %}'>


  {% endblock estilos %}
</head>

<body>




  {% block cuerpo %}


  {% if user.is_authenticated %}

  <!-- Modal para opciones de guardar-->
  <div class="modal fade" id="ModalMenu" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Agregar</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <button type="button" data-toggle="modal" data-target="#ModalMenuAdd" class="btn btn-primary"
            onclick="newMenu()" data-dismiss="modal">Menu</button>
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalSubMenuAdd"
            id="btnSubmenuid" data-dismiss="modal">Submenu</button>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

        </div>
      </div>
    </div>
  </div>
  <!-- ------------------------------------------- -->




  <!-- Modal guardar areas -->
  <div class="modal fade" id="ModalMenuAdd" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Agregar</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

          <form method="POST" action="" class="post-form" id="todo-form">{% csrf_token %}

            <div class="form-row">

              
              <div class="form-group col-md-6">
                <div class="text-danger">
                  {{ form.errors }}
                </div>
                <label for="">cod</label>
                <input type="text" name="{{ form.linkP1.name }}" class="form-control">
              </div>
              <div class="form-group col-md-6">
                <label for="">Area</label>
                <input type="text" id="id_name" name="{{ form.name.name }}" class="form-control">
              </div>
              <div class="form-group col-md-6">
                <label for="">Enlace</label>
                <input type="text" name="{{ form.enlaceP.name }}" class="form-control">
              </div>
              <div class="form-group col-md-6">
                <label for="">Descripción</label>
                <input type="text" name="{{ form.description.name }}" class="form-control">
              </div>
              <div class="form-group col-md-6">

                <a href="" data-toggle="modal" data-target=".bd-example-modal-sm">


                  <input type="hidden" name="{{ form.icon.name }}" value="bx bx-happy" id="envio-icon">
                  <span id="icon-post">icono</span> <br><i class='bx bx-happy icon-item icon-happy' id="iconoP"></i></a>
              </div>
              <div class="form-group col-md-6">

                <div class="form-check form-switch">
                  <label for="che-estado">
                    <input id="che-estado" class="form-check-input" type="checkbox" name="{{ form.state.name }}" checked>
                    estado</label>
                </div>

              </div>
            </div>


            <!-- <div class="form-group col-md-4">
        <label for="inputState">State</label>
        <select id="inputState" class="form-control">
          <option selected>Choose...</option>
          <option>...</option>
        </select>
      </div> 
 
     <div class="form-group">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="gridCheck">
        <label class="form-check-label" for="gridCheck">
          Check me out
        </label>
      </div>
    </div>  -->
            <button class="save btn btn-primary" >Guardar</button>

          </form>


          <!-- <div class="content container">
    <div class="row">
        <div class="col-md-8">
       
      <form method="POST" class="post-form">{% csrf_token %}
          {{ form.as_p }}
          <button  class="save btn btn-default">Save</button>
      </form>
         
           
        </div>
    </div>
  </div> -->

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>

        </div>
      </div>
    </div>
  </div>
  <!-- ----------------------------------------------------------- -->

  <!-- Modal guardar subareas -->
  <div class="modal fade" id="ModalSubMenuAdd" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Agregar</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

          <form method="POST" action="" class="post-form" id="todo-form2">{% csrf_token %}

            <div class="form-row">
              <div class="form-group col-md-6">
                <div class="text-danger">
                  {{ form2.errors }}
                </div>
                <label for="">Subárea</label>
                <input type="text" name="{{ form2.name.name }}" class="form-control">
              </div>

              <div class="form-group col-md-6">
                <label for="">Enlace</label>
                <input type="text" name="{{ form2.enlaceP.name }}" class="form-control">
              </div>
              <div class="form-group col-md-6">
                <label for="">Descripción</label>
                <input type="text" name="{{ form2.description.name }}" class="form-control">
              </div>

              <div class="form-group col-md-6">

                <label for="">Área</label>
               

                <select class="browser-default custom-select combo" onchange="filtroArea()" id="area">

                  {% for area in link %}
                  <option value="{{area.linkP1}}" class="datosFiltros" id="filtro{{area.linkP1}} ">{{area.name}}</option>
                  {% endfor %}

                </select>
                <input type="hidden" name="{{ form2.linkP.name }}" value="p1" id="GuardarIdS">


              </div>
              <div class="form-group col-md-6">

                <div class="form-check form-switch">
                  <label for="che-estado">
                    <input id="che-estado" class="form-check-input" type="checkbox" name="{{ form2.state.name }}" checked>
                    estado</label>
                </div>

              </div>
            </div>



            <button class="save btn btn-primary">Guardar</button>

          </form>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>

        </div>
      </div>
    </div>
  </div>

  <!-- Modal para los iconos Guardar -->
  <div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="caja-ico">
          {% for icono in icon %}
          <i class='{{icono.name}} ico-modal' onclick="iconclick('{{icono.name}}') " data-dismiss="modal"></i>

          {% if forloop.counter == 10 %}
          <br>
          {% endif %}
          {% endfor %}


        </div>

      </div>
    </div>
  </div>
  <!-- ------------------------- -->


  <!-- Modal para los iconos Actualizar -->
  <div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
    aria-hidden="true" id="ModalUpddate">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="caja-ico">
          {% for icono in icon %}
          <i class='{{icono.name}} ico-modal' onclick="iconclickUpdate('{{icono.name}}') " data-dismiss="modal"></i>

          {% if forloop.counter == 10 %}
          <br>
          {% endif %}
          {% endfor %}
       </div>
      </div>
    </div>
  </div>
  <!-- ------------------------- -->


  <!-- ---------------------------- -->
  <div class="header">
    <h3 class="encabezado">Administración de enlaces por menu y submenus</h3>
    <div class="caja-tabla">
      <div class="caja-box">

        <form action="" method="post">
          {% csrf_token %}
           <select class="browser-default custom-select combo" onchange="filtroAreaP()" id="areaP">
          <option selected="" value="TFiltro" id="todoFiltro">Filtrar por area- TODO</option>
          {% for area in link %}
          <option name="buscando" onchange="" value="{{area.id}}" class="datosFiltros" id="filtro{{area.id}} ">{{area.name}} </option>          
          {% endfor %}

        </select>
     
        </form>
       
     
      </div>

      <button type="button" data-toggle="modal" data-target="#ModalMenu"
        class="btn btn-primary btn-nuevo">Añadir</button>



      <table class="table" id="tablaT">
        <thead class="table" id="table-head">
          <tr>
            <th></th>
            <th>ID</th>
            <th>Area</th>
            <th>Enlace</th>
            <th>Descripción</th>
            <th>icono</th>
            <th>Estado</th>
            <th colspan="3">Acciones</th>
            <!-- <th>Eliminar</th>
            <!-- <th>Guardar</th> 
            <th>Nuevo</th> -->

          </tr>
        </thead>
        <tbody>



          {% for enlace in link %}

          <form action="{% url 'update' enlace.id %}" method="post" class="post-form" id="FormUpdate{{enlace.id}}">
            {% csrf_token %}

            <tr class="item-main contenidoMenu" id="contenidoMenu{{enlace.id}}">
              <td onclick="showHideRow('{{enlace.linkP1}}');"><i class='bx bx-list-ul icon-flecha icon-item'
                  id="{{enlace.linkP1}}"></i></td>
              <td> <input type="text" name="{{form.id.name}}" id="" class="text-id form-control txt-general "
                  value="{{enlace.id}}" readonly></td>
              <td><input type="text" name="{{form.name.name}}" id="" class="form-control txt-general "
                  value="{{enlace.name}}"></td>
              
              <td><input type="text" name="{{form.enlaceP.name}}" id="" class="form-control txt-general "
                  value="{{enlace.enlaceP}}"></td>
              
              <td><input type="text" name="{{form.description.name}}" id="" class="form-control txt-general "
                  value="{{enlace.description}}"></td>
              
              <td>
                <input type="hidden" name="" id="data-respaldo">
                <!--Para formulario--><input type="hidden" name="{{form.icon.name}}" value="{{enlace.icon}}"
                  id="envio-icon-{{enlace.id}}">
                <a href="" data-toggle="modal" data-target="#ModalUpddate" onclick="guardarDato('{{enlace.id}}') "><i
                    class="{{enlace.icon}} icon-item icon-happy" id="iconoP-{{enlace.id}}"></i></a>
                 
              </td>
              <td>
                <div class="form-check form-switch">
                  {% if enlace.state %}
                  <input class="form-check-input" name="{{form.state.name}}" type="checkbox" id="flexSwitchCheckChecked"
                    checked>
                  {% else %}
                  <input class="form-check-input" name="{{form.state.name}}" type="checkbox"
                    id="flexSwitchCheckChecked">
                  {% endif %}
                </div>
              </td>
              <!-- onclick="javascript:document.getElementById(`FormUpdate`).submit();
                return false;"  -->
              <td> <a href="" onclick="confirmarUpdate(`FormUpdate{{enlace.id}}`); return false;" class="Button"><i
                    class='bx bxs-save icon-item icon-update' id=""></i></i></a></td>
              <td> <a href="{% url 'delete' enlace.id %}" onclick="confirm('¿Estas seguro de Eliminar este registro?'); return false;" class="modal-action modal-close waves-effect waves-green btn-flat "><i
                    class='bx bxs-trash icon-item icon-delete' id=""></i></a></td>
              <!-- <td> <a href=""><i class='bx bx-save' ></i></a></td> -->
              <td> <a href="" data-toggle="modal" data-target="#ModalMenu"><i
                    class='bx bxs-add-to-queue icon-item icon-nuevo'></i></a></td>
            </tr>
          </form>
          {% for enlace2 in link2 %}


          {% if enlace.linkP1 == enlace2.linkP %}
          <form action="{% url 'update2' enlace2.id %}" method="post" id="FormUpdate2{{enlace2.id}}">
            {% csrf_token %}
            <tr class="{{enlace2.linkP}} hidden_row submenu filtroSubmenu">
            <td></td>
            <td> <input readonly type="text" name="{{form2.id.name}}" id="" class="text-id form-control txt-general" value="{{enlace2.id}}"></td>
            <td><input type="text" name="{{form2.name.name}}" id="" class="form-control txt-general" value="{{enlace2.name}}"></td>
            </td>
            <td><input type="text" name="{{form2.enlaceP.name}}" id="" class="form-control txt-general" value="{{enlace2.enlaceP}}"></td>
            </td>
            <td><input type="text" name="{{form2.description.name}}" id="" class="form-control txt-general" value="{{enlace2.description}}"></td>
            </td>
            <td>
              
            </td>
            <td>
              <div class="form-check form-switch">
                {% if enlace2.state %}
                <input class="form-check-input" name="{{form2.state.name}}" type="checkbox" id="flexSwitchCheckChecked"
                  checked>
                {% else %}
                <input class="form-check-input" name="{{form2.state.name}}" type="checkbox"
                  id="flexSwitchCheckChecked">
                {% endif %}
              </div>

              
            </td>
            <td> <a href="" onclick="confirmarUpdate2(`FormUpdate2{{enlace2.id}}`); return false;"><i class='bx bxs-save icon-item icon-update'></i></i></a></td>
            <td> <a href="{% url 'delete2' enlace2.id %}" onclick="confirm('¿Estas seguro de Eliminar este registro?'); return false;"><i class='bx bxs-trash icon-item icon-delete'></i></a></td>
            <!-- <td> <a href=""><i class='bx bx-save' ></i></a></td> -->
            <td> </td>

          </tr>
          </form>
          

          {% endif %}

          {%endfor%}

          {% endfor %}







        </tbody>
      </table>
    </div>

  </div>



 


{% block javascript %}
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->


    


    <script>
 
      
          // preventing from page reload and default actions
        
        // make POST ajax call
            // catch the form's submit event
            $('#todo-form').submit(function (e) {
              e.preventDefault();
        // serialize the data for sending the form data.
        var serializedData = $(this).serialize();
                // create an AJAX call
                $.ajax({
                    data: serializedData, // get the form data
                    type:'POST', // GET or POST
                    url: "{% url 'admin' %}",
                    
                    // on success
                    success: function (response) {
                      $("#todo-form").trigger('reset');
                      alert("Guardado Con éxito " );
                      $("#id_name").focus();
                      var instance = JSON.parse(response["instance"]);
                      var fields = instance[0]["fields"];
                      console.log(instance[0]);

                      var tabla = ``;
                      tabla +=`<tr>
                      <td onclick="showHideRow('{{enlace.linkP1}}');"><i class='bx bx-list-ul icon-flecha icon-item'
                  id=""></i></td>

                  <td> <input type="text" name="" id="" class="text-id form-control txt-general "
                  value="${instance[0]["pk"]||""}" readonly></td>

                  <td><input type="text" name="{{form.name.name}}" id="" class="form-control txt-general "
                  value="${fields["name"]||""}"></td>
                  
                  <td><input type="text" name="{{form.enlaceP.name}}" id="" class="form-control txt-general "
                  value="${fields["enlaceP"]||""}"></td>
                    
                  <td><input type="text" name="{{form.description.name}}" id="" class="form-control txt-general "
                  value="${fields["description"]||""}"></td>


                  <td>
                <input type="hidden" name="" id="data-respaldo">
                <!--Para formulario--><input type="hidden" name="{{form.icon.name}}" value="${fields["icon"]||""}"
                  id='envio-icon-"${instance[0]["pk"]||""}"'>
                <a href="" data-toggle="modal" data-target="#ModalUpddate" onclick='guardarDato("${instance[0]["pk"]||""}") '><i
                    class="${fields["icon"]||""} icon-item icon-happy" id="iconoP-"${instance[0]["pk"]||""}"></i></a>
                 
              </td>`
                if (fields["state"]){
             
                 tabla += `
                
                 <td> <div class="form-check form-switch">
                  <input type="checkbox" id="flexSwitchCheckChecked" class="form-check-input" name="${fields["state"]}" 
                    checked> </td>` 
                }else{
                  
                  tabla += `<td>
                  <input class="form-check-input" name="${fields["state"]}" type="checkbox" id="flexSwitchCheckChecked"
                    >  </div></td>

                  
                    ` 

                }
              

                 tabla +=`
                 <td> <a href="" onclick="confirmarUpdate('FormUpdate${instance[0]["pk"]||""}'); return false;" class="Button"><i
                    class='bx bxs-save icon-item icon-update' id=""></i></i></a></td>

                    <td> <a href="" onclick="confirm('¿Estas seguro de Eliminar este registro?'); return false;" class="modal-action modal-close waves-effect waves-green btn-flat "><i
               
                      class='bx bxs-trash icon-item icon-delete' id=""></i></a></td>
              <!-- <td> <a href=""><i class='bx bx-save' ></i></a></td> -->
              <td> <a href="" data-toggle="modal" data-target="#ModalMenu"><i
                    class='bx bxs-add-to-queue icon-item icon-nuevo'></i></a></td>
                 </tr>`
                    $("#tablaT tbody").prepend(tabla)

                    },
                    // on error
                    error: function (response) {
                        // alert the error if any error occured
                        alert(response["responseJSON"]["error"]);
                    }
                });
                return false;
            });
        
    </script>
    {% endblock javascript %}


{% else %}

<p>You are not logged in</p>
<a href="{% url 'login' %}">Log In</a>
{% endif %}

  {% endblock cuerpo %}

</body>

</html>